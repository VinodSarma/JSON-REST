import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.URL;
import java.util.ArrayList;
import java.net.HttpURLConnection;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

public class GetObjects {
        public static void get_ind_list()
        {
                //ArrayList<Tuple> tuple_list =  new ArrayList<Tuple>();
                Long deviceId , objectId,ind_id;
                String inputLine;
                JSONParser parser = new JSONParser();
                //GetToken token    = new GetToken();
                try {
                        URL url                = new URL("http://19.19.19.111:80/api/v1/devices/3/objects?size=20&includeIndicators=true"); // URL to Parse
                        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
                        conn.setDoOutput(true);
                         String auth_token = "279346757CeF748e7CeF11e67CeF9cb67CeF000c2970ea8b";

                   conn.setRequestProperty("X-Auth-Token",auth_token);
                        conn.setDoInput(true);
                        conn.setRequestMethod("GET");
                        conn.setRequestProperty("Content-Type","application/json");
                     //   conn.setRequestProperty("Accept","application/json");

               //if (conn.getResponseCode() != 200) {
                         //       throw new RuntimeException("Failed : HTTP error code : "+ conn.getResponseCode());
                       // }

                        BufferedReader in  = new BufferedReader(new InputStreamReader(conn.getInputStream()));
                        while ((inputLine = in.readLine()) != null) {
                                JSONObject content_obj    =   (JSONObject) parser.parse(inputLine);
                                JSONArray  content_arr    =   (JSONArray) content_obj.get("content");

                                     for(Object element : content_arr){
                                                JSONObject object_obj = (JSONObject) element;
                                                objectId              = (Long) object_obj.get("id");
                                                System.out.println("object id is : " + objectId);
                                                JSONArray  ind_arr = (JSONArray) object_obj.get("indicators");
                                                for(Object ind : ind_arr)
                                                {
                                                        JSONObject ind_obj = (JSONObject) ind;
                                                        ind_id =  (Long) ind_obj.get("id");
                                                System.out.println("ind id is : " + ind_id);
                                               }
                                        }

                        }
                        in.close();
                                               conn.disconnect();
                } catch (FileNotFoundException e) {
                        e.printStackTrace();
                } catch (IOException e) {
                        e.printStackTrace();
                }
                catch (ParseException e) {
                        e.printStackTrace();
                }
        }

        public static void main(String[] args)
        {
                 get_ind_list();
        }
}
