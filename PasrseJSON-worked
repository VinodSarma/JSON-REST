import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.URL;
import java.util.ArrayList;
import java.net.HttpURLConnection;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

public class ParseSevOneJson  {
        public static void get_device_obj_list(String ipaddr)
        {
                //ArrayList<Tuple> tuple_list =  new ArrayList<Tuple>();
                Long deviceId , objectId;
                String inputLine;
                JSONParser parser = new JSONParser();
                //GetToken token    = new GetToken();
                try {
                        URL url                = new URL("http://19.19.19.111:80/api/v1/devices/filter"); // URL to Parse
                        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
                        conn.setDoOutput(true);
                         String auth_token = "727d9b50d9eD73e8d9eD11e6d9eD9cb6d9eD000c2970ea8b";

                   conn.setRequestProperty("X-Auth-Token",auth_token);
                        conn.setDoInput(true);
                        conn.setRequestMethod("POST");
                        conn.setRequestProperty("Content-Type","application/json");
                        conn.setRequestProperty("Accept","application/json");

                        String input =

                                "{\n"+
                                "    \"name\": \"SDWAN Topology\"\n" +
                                "}";

                        System.out.println(input);
                        OutputStream os = conn.getOutputStream();
                        os.write(input.getBytes());
                        os.flush();
               //if (conn.getResponseCode() != 200) {
                         //       throw new RuntimeException("Failed : HTTP error code : "+ conn.getResponseCode());
                       // }

                        BufferedReader in  = new BufferedReader(new InputStreamReader(conn.getInputStream()));
                        while ((inputLine = in.readLine()) != null) {
                                JSONObject content_obj    =   (JSONObject) parser.parse(inputLine);
                                JSONArray  content_arr    =   (JSONArray) content_obj.get("content");

                                     for(Object element : content_arr){
                                                JSONObject object_obj = (JSONObject) element;
                                                deviceId              = (Long) object_obj.get("id");
                                                System.out.println("device id is : " + deviceId);
                                        }

                        }
                        in.close();

                        conn.disconnect();
                } catch (FileNotFoundException e) {
                        e.printStackTrace();
                } catch (IOException e) {
                        e.printStackTrace();
                }
                catch (ParseException e) {
                        e.printStackTrace();
                }
        }

        public static void main(String[] args)
        {
                 get_device_obj_list("SDWAN Topology");
        }
}
